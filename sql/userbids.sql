CREATE ALGORITHM=UNDEFINED SQL SECURITY DEFINER VIEW `v_userbids` AS select `b`.`user_id` AS `user_id`,cast(`b`.`created_at` as date) AS `date`,sum(`b`.`proposed_amount`) AS `total_amount`,count(`b`.`id`) AS `nobid`,(case when (count(`b`.`id`) > 5) then 2 when (count(`b`.`id`) > 2) then 1 else 0 end) AS `share` from `bids` `b` where ((`b`.`created_at` >= ((last_day(curdate()) + interval 1 day) - interval 1 month)) and (`b`.`created_at` < (last_day(curdate()) + interval 1 day))) group by `date`,`b`.`user_id`;